\doxysection{Storage\+Engine.\+h}
\hypertarget{_storage_engine_8h_source}{}\label{_storage_engine_8h_source}\index{include/core/StorageEngine.h@{include/core/StorageEngine.h}}
\mbox{\hyperlink{_storage_engine_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <filesystem>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_commit_8h}{../entities/Commit.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_file_8h}{../entities/File.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_graph_manager_8h}{GraphManager.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }fs\ =\ std::filesystem;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecore}{core}}\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classcore_1_1_storage_engine_ad0043a1e69a9497d0372eab100070af0}{StorageEngine}}\ \{}
\DoxyCodeLine{00034\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classcore_1_1_storage_engine_ad0043a1e69a9497d0372eab100070af0}{StorageEngine}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcore_1_1_storage_engine_a0611fbdd0e7782aa46f4fa241213d016}{restore\_files}}(\mbox{\hyperlink{classentities_1_1_commit}{entities::Commit}}*\ commit,\ \mbox{\hyperlink{classcore_1_1_graph_manager}{GraphManager}}\&\ graph\_manager)\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!commit)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ files\ =\ commit-\/>\mbox{\hyperlink{classentities_1_1_commit_aa9cab2f0605657ad8d3ddd3abb67a909}{get\_files}}();}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (files.empty())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ files.begin();\ it\ !=\ files.end();\ ++it)\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ hash\ =\ it-\/>get\_hash();}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ content\ =\ graph\_manager.\mbox{\hyperlink{classcore_1_1_graph_manager_a19147bcce2799c3c06434812434e1a3a}{get\_blob\_content}}(hash);}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcore_1_1_storage_engine_a677628a39925d0e418e60b09d374a334}{save\_file\_to\_disk}}(it-\/>get\_path(),\ content);}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcore_1_1_storage_engine_a677628a39925d0e418e60b09d374a334}{save\_file\_to\_disk}}(\textcolor{keyword}{const}\ std::string\&\ path,\ \textcolor{keyword}{const}\ std::string\&\ content)\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ fs::path\ file\_path(path);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (file\_path.has\_parent\_path())\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ fs::create\_directories(file\_path.parent\_path());}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ std::ofstream\ out\_file(path,\ std::ios::trunc);}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (out\_file.is\_open())\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ out\_file\ <<\ content;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ out\_file.close();}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Restored:\ "{}}\ <<\ path\ <<\ std::endl;}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}Error:\ Could\ not\ write\ to\ file\ "{}}\ <<\ path\ <<\ std::endl;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \}\ \textcolor{comment}{//\ namespace\ core}}

\end{DoxyCode}
