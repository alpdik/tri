\doxysection{Storage\+Engine.\+h}
\hypertarget{_storage_engine_8h_source}{}\label{_storage_engine_8h_source}\index{include/core/StorageEngine.h@{include/core/StorageEngine.h}}
\doxymbox{\hyperlink{_storage_engine_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <filesystem>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\doxymbox{\hyperlink{_commit_8h}{../entities/Commit.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\doxymbox{\hyperlink{_file_8h}{../entities/File.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\doxymbox{\hyperlink{_graph_manager_8h}{GraphManager.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{namespace\ }fs\ =\ std::filesystem;}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{namespace\ }\doxymbox{\hyperlink{namespacecore}{core}}\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keyword}{class\ }\doxymbox{\hyperlink{classcore_1_1_storage_engine_ad0043a1e69a9497d0372eab100070af0}{StorageEngine}}\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{classcore_1_1_storage_engine_ad0043a1e69a9497d0372eab100070af0}{StorageEngine}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classcore_1_1_storage_engine_a0611fbdd0e7782aa46f4fa241213d016}{restore\_files}}(\doxymbox{\hyperlink{classentities_1_1_commit}{entities::Commit}}*\ commit,\ \doxymbox{\hyperlink{classcore_1_1_graph_manager}{GraphManager}}\&\ graph\_manager)\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!commit)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ files\ =\ commit-\/>\doxymbox{\hyperlink{classentities_1_1_commit_aa9cab2f0605657ad8d3ddd3abb67a909}{get\_files}}();}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (files.empty())\ \textcolor{keywordflow}{return};\ }
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ it\ =\ files.begin();\ it\ !=\ files.end();\ ++it)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ hash\ =\ it-\/>get\_hash();}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ content\ =\ graph\_manager.\doxymbox{\hyperlink{classcore_1_1_graph_manager_a7a7b489ebfa1b5161b7ad4f5bc36a0c7}{get\_blob\_content}}(hash);}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \doxymbox{\hyperlink{classcore_1_1_storage_engine_a677628a39925d0e418e60b09d374a334}{save\_file\_to\_disk}}(it-\/>get\_path(),\ content);}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \doxymbox{\hyperlink{classcore_1_1_storage_engine_a677628a39925d0e418e60b09d374a334}{save\_file\_to\_disk}}(\textcolor{keyword}{const}\ std::string\&\ path,\ \textcolor{keyword}{const}\ std::string\&\ content)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ fs::path\ file\_path(path);}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (file\_path.has\_parent\_path())\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fs::create\_directories(file\_path.parent\_path());}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ std::ofstream\ out\_file(path,\ std::ios::trunc);}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (out\_file.is\_open())\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ out\_file\ <<\ content;}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ out\_file.close();}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Restored:\ "{}}\ <<\ path\ <<\ std::endl;}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}Error:\ Could\ not\ write\ to\ file\ "{}}\ <<\ path\ <<\ std::endl;}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \};}
\DoxyCodeLine{00057\ \}}

\end{DoxyCode}
